---
title: "Coffee Drinking Habits and Working Lifestyle"
subtitle: "INFO 526 - Summer 2024 - Final Project"
author: "Vera Jackson"
title-slide-attributes:
  data-background-image: images/coffee_cover.jpg
  data-background-size: stretch
  data-background-opacity: "0.4"
  data-slide-number: none
format:
  revealjs:
    theme:  ['data/customtheming.scss']
  
editor: visual
execute:
  echo: false
bibliography: references.bib
---

```{r}
#| label: load-packages
#| include: false

# Load packages here
pacman::p_load(dplyr,
               tidyverse, 
               glue, 
               scales, 
               here, 
               ggthemes, 
               janitor, 
               ggplot2, 
               readr,
               ggrepel)

```

```{r}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 11))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618 
  )
```

```{r}
#| label: load-data
#| include: false


# load data here
coffee_survey <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2024/2024-05-14/coffee_survey.csv')

# glimpse at data (4,042 rows)
coffee_survey

```

## Coffee: a habit, ritual, necessity, luxury

-   75% of the US population drink coffee [@loftfield2016]

-   Studies have shown that lifestyle and demographic factors influence intake [@loftfield2016]

## Coffee: a habit, ritual, necessity, luxury

-   75% of the US population drink coffee [@loftfield2016]

-   Studies have shown that lifestyle and demographic factors influence intake [@loftfield2016]

**What are the correlations between coffee consumption and lifestyle?**

## The "Great American Coffee Taste Test" data set

-   Survey results filled out by taste test participants, co-hosted by U.S.-based coffee company Cometeer. [@tracykteal2024]

-   The survey includes questions about coffee drinking habits, coffee preferences, individual taste test results for each of the 4 provided coffees, and individual demographics.

![Image credit: Cometeer, cometeer.com [@cometeer].](images/cometeer_logo.png){fig-align="center" width="415"}

## The Data

Variables: `cups, employment_status, number_children, wfh, age`

```{r, echo=FALSE}
#| label: introducing data


coffee_survey_cleanNA <- coffee_survey %>% 
  select(cups, employment_status, number_children, wfh, age) %>% 
  filter(!is.na(cups)) %>% 
  filter(!is.na(employment_status)) %>%
  filter(!is.na(wfh)) %>% 
  filter(!is.na(number_children)) %>% 
  filter(!is.na(age)) 

coffee_survey_cleanNA

```

```{r, echo=FALSE}
#| label: code for plot 1 and 2
#| include: false

##############
# cleaning for general and plot 1
# selecting relevant variables for both plots (3,343 rows)

coffee_survey_count_cups <- coffee_survey_cleanNA %>% 
  count(cups) %>% # counting total count for each employment_status
  rename(total_cups = n)

manual_order <- c("Less than 1", "1", "2", "3", "4", "More than 4")

# Reorder the dataset according to the manual order
coffee_survey_count_cups <- coffee_survey_count_cups[match(manual_order, coffee_survey_count_cups$cups), ]
coffee_survey_count_cups
#calculating percentages
coffee_survey_count_cups <- coffee_survey_count_cups %>% 
  mutate(percent = total_cups/sum(total_cups))

coffee_survey_count_cups <- coffee_survey_count_cups %>% 
  mutate(percent = percent(coffee_survey_count_cups$percent, accuracy = 0.1)) 
  
coffee_survey_count_cups
#mutate to manually position labels on pie chart
coffee_survey_count_plot1 <- coffee_survey_count_cups %>% 
  mutate(csum = rev(cumsum(rev(total_cups))),
         pos = total_cups/2 + lead(csum, 1),
         pos = if_else(is.na(pos), total_cups/2, pos))

# plot 1 ^
###################


```

```{r, echo=FALSE}
#| label: code for plot 3 and 4
#| fig-height: 6
#| fig-width: 6


coffee_survey_filter1 <- coffee_survey %>% 
  select(submission_id, cups, employment_status, number_children, wfh, age) %>% 
  filter(!is.na(cups)) %>% 
  mutate(
    cups = recode(cups,
                  "Less than 1" = "0",
                  "1" = "1",
                  "2" = "2",
                  "3" = "3",
                  "4" = "4",
                  "More than 4" = "5")) 


coffee_survey_filter1_longer <- coffee_survey_filter1 %>% 
  pivot_longer(
    cols = c("employment_status", "number_children", "age", "wfh"), 
    names_to = "explanatory",
    values_to = "explanatory_value"
    ) %>% 
  filter(!is.na(explanatory_value)) %>% 
  pivot_longer(
    cols = c("cups"),
    names_to = "response",
    values_to = "response_value"
  )


# now i will group the data and calculate summary statistics
coffee_survey_filter1_longer$response_value <- as.numeric(coffee_survey_filter1_longer$response_value)


coffee_survey_stats_all <- coffee_survey_filter1_longer %>% 
  group_by(response) %>% 
 summarise(
    mean = mean(response_value),
    low = quantile(response_value, 0.10),
    high = quantile(response_value, 0.90)
  ) %>% 
  mutate(across(c("mean"), round, 2)) #mean output was returning values with 4 decimal places

coffee_survey_stats_all$explanatory <- c("All")
coffee_survey_stats_all$explanatory_value <- c("")

#now by group
coffee_survey_stats_by_group <-  coffee_survey_filter1_longer %>% 
  filter(!is.na(response_value)) %>% 
  group_by(explanatory, explanatory_value, response) %>% 
  summarise(
    mean = mean(response_value),
    low = quantile(response_value, 0.10),
    high = quantile(response_value, 0.90)
  ) %>% 
  mutate(across(c("mean"), round, 2)) #mean output was returning values with 4 decimal places
  


#now to bind together both groups
coffee_survey_stats <- bind_rows(
  coffee_survey_stats_all,
  coffee_survey_stats_by_group)



#new label for explanatory variable facet
exp.labs <- c(
  "All",
  "Age",
  "Number of \nChildren",
  "Employment \nStatus",
  "In-Person or \nVirtual Work")

names(exp.labs) <- c(
  "All", 
  "age", 
  "number_children", 
  "employment_status", 
  "wfh")


coffee_survey_stats$explanatory = factor(coffee_survey_stats$explanatory, levels = c("All", "age", "number_children", "employment_status", "wfh"), ordered = TRUE) #manually order explanatory for facet


p3 <- coffee_survey_stats %>% 
  mutate(explanatory_value = fct_relevel(explanatory_value, 
                                         "", 
                               "<18 years old",
                               "18-24 years old",
                               "25-34 years old",
                               "35-44 years old",
                               "45-54 years old",
                               "55-64 years old",
                               ">65 years old",
                               "None",
                               "1",
                               "2",
                               "3",
                               "More than 3",
                               "Unemployed",
                               "Student",
                               "Homemaker",
                               "Employed part-time",
                               "Employed full-time",
                               "Retired",
                               "I primarily work in person",
                               "I primarily work from home",
                               "I do a mix of both")) %>%
  ggplot(aes(x = mean, y = explanatory_value)) +
  geom_point() +
  geom_errorbar(aes(xmin = low, xmax = high), 
                width = 0.2) +
  facet_grid(explanatory ~ ., 
             scales = "free", 
             space = "free",
             labeller = labeller(explanatory = exp.labs)) +
  scale_x_continuous(limits = c(0, 5), breaks = c(0, 1, 2, 3, 4, 5), 
    labels = label_wrap(10)(c("Less than 1", "1", "2", "3", "4", "More than 4"))) +
  labs(
    x = "Number of Cups \n(Error bars range from 10th to 90th percentile)",
    y = NULL
  ) +
  theme_minimal() +
  theme(
    panel.grid = element_blank(), #remove lines in plot
    panel.spacing = unit(0.1, "cm"), #spacing between facets
    strip.text = element_text(colour = "black"),
    strip.background = element_rect( #creating blocks for facet labels to match original
      fill = "grey90", 
      color = "grey20", 
      linewidth = 1),
    strip.text.y = element_text(angle = 0)) #turn explanatory facets from vertical to horizontal)

```

```{r, echo=FALSE}
#finally, who is drinking the most coffee??



survey_1 <- coffee_survey_filter1_longer %>% #editing response values so number equals actual response
  mutate(response_value = case_when(
    response_value == "0" ~ "Less than 1",
    response_value == "1" ~ "1",
    response_value == "2" ~ "2",
    response_value == "3" ~ "3",
    response_value == "4" ~ "4",
    response_value == "5" ~ "More than 4")
    )



coffee_survey_percentage <- survey_1 %>% #calculate sums and percentages for diverging plot
  filter(!is.na(response_value)) %>% 
  group_by(explanatory, explanatory_value, response, response_value) %>% 
  summarise(count = n(), .groups = "drop") %>% 
  group_by(explanatory_value) %>% 
  mutate(percent_answers = (count / sum(count))) %>% 
  ungroup() %>% 
  mutate(percent_answers_label = percent(percent_answers, accuracy = 1)) %>% 
  mutate(percent_answers = 
           if_else(response_value %in% 
                     c("4"), 
                   percent_answers/2, percent_answers)) #method to make diverging bar plot with neutral in the middle
  
coffee_survey_percentage <- coffee_survey_percentage %>% 
  mutate(explanatory_value = fct_relevel(explanatory_value, 
                               "<18 years old",
                               "18-24 years old",
                               "25-34 years old",
                               "35-44 years old",
                               "45-54 years old",
                               "55-64 years old",
                               ">65 years old",
                               "None",
                               "1",
                               "2",
                               "3",
                               "More than 3",
                               "Unemployed",
                               "Student",
                               "Homemaker",
                               "Employed part-time",
                               "Employed full-time",
                               "Retired",
                               "I primarily work in person",
                               "I primarily work from home",
                               "I do a mix of both")) %>% 
  mutate(explanatory = fct_relevel(explanatory, 
                               "age",
                               "number_children",
                               "employment_status",
                               "wfh"))

coffee_survey_percentage$response_value <- factor(coffee_survey_percentage$response_value, levels = c("Less than 1", "1", "2", "3", "4", "More than 4"), ordered = TRUE) #manually order response value for facet


p4 <- coffee_survey_percentage %>% 
  ggplot(aes(x = explanatory_value,
             y = percent_answers,
             fill = response_value)) +
  geom_col(data = filter(coffee_survey_percentage, 
                         response_value %in% c("Less than 1")), 
           aes(y = -percent_answers)) +
  geom_col(data = filter(coffee_survey_percentage, 
                         response_value %in% c("4", "More than 4")), 
           aes(y = percent_answers)) +
  scale_fill_manual(breaks = c("Less than 1", "4", "More than 4"),
                    values = c("#87A5A5FF", "#D2D2C3FF", "#A5A587FF")) +
  facet_grid(explanatory ~ ., 
             scales = "free", 
             space = "free",
             labeller = labeller(explanatory = exp.labs)) +
  labs(
    title = "Responses Outside of Average",
    x = NULL,
    y = "Percent of Responses",
    fill = "Number of Cups"
  ) +
  coord_flip() +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  theme(title = element_text(face = "bold"),
        panel.grid.major.y = element_blank(),
        legend.text.position = "top",
        legend.title = element_text(hjust = 0.5, face = "bold"),
        legend.background = element_rect(
          fill = "grey90", 
          colour = "grey20", 
          linewidth = 0.5),
        axis.title = element_text(face = "bold"),
        strip.text = element_text(size = 7),
    strip.background = element_rect( #creating blocks for facet labels to match original
      fill = "grey90", 
      color = "grey20", 
      linewidth = 1),
    strip.text.y = element_text(angle = 0)) #turn explanatory facets from vertical to horizontal))


```

## How Much Coffee Would a Coffee Drinker Drink . . .

```{r, warning=FALSE, fig.width=5.5, fig.align="center"}
#plot 1

p <- coffee_survey_count_plot1 %>%  
  mutate(cups = fct_relevel(cups, 
                               "Less than 1",
                               "1",
                               "2",
                               "3",
                               "4",
                               "More than 4")) %>% 
  ggplot(aes(x = "", y = total_cups, fill = cups)) +
  geom_bar(stat = "identity", width = 1, color = "black") +
  coord_polar(theta = "y") +
  scale_x_discrete(NULL, expand = c(0, 0)) +
  scale_y_continuous(NULL, expand = c(0, 0)) +
  scale_fill_manual(values = 
                      c("#87A5A5FF", "#BCAAA4FF", 
                        "#A1887FFF", "#D2A54BFF",
                        "#D2D2C3FF", "#A5A587FF" 
                       ), name = "Number of Cups") +
  geom_label_repel( 
    mapping = aes(y = pos, label = paste(percent)),
    size = 3,
    nudge_x = 0.9,
    show.legend = FALSE) +
  labs(
    title = "Distrubution of Daily Cups of Coffee \nAmong Responses \n "
  ) +
  theme_void() +
  theme(
    axis.text = element_blank(),
    plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
    plot.title.position = "plot",
    legend.text = element_text(size = 8), #text of legend
    legend.key.size = unit(0.5, "cm")
  ) 

p
```

## All Variables Accounted For

Average amount of coffee ranges between 1 and 3 cups

```{r, warning=FALSE, fig.width=6, fig.height = 6, fig.align="center"}
p3
```

## The Extremes

```{r, warning=FALSE, fig.width=5.5, fig.align="center"}
p4
```

## Conclusion

-   Average cups of coffee ranges between 1 - 3 cups for each group

## Conclusion

-   Average cups of coffee ranges between 1 - 3 cups for each group
-   Drinking less than 1 cup of coffee is more common among those less than 24 years old, no kids, and unemployed.
-   Drinking more than average is more common among those 45 years old and older, with many kids, and retired.

## Conclusion

-   Average cups of coffee ranges between 1 - 3 cups for each group
-   Drinking less than 1 cup of coffee is more common among those less than 24 years old, no kids, and unemployed.
-   Drinking more than average is more common among those 45 years old and older, with many kids, and retired.
-   Future work should consider the weight of age on coffee drinking habits or correlation between factors - what truly has a weight on these habits?

## References
